<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Buat Notifikasi Baru</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.10.2/dist/full.min.css" rel="stylesheet" type="text/css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
</head>
<body class="bg-gradient-to-br from-green-50 to-green-100 min-h-screen">
<%- include('admin-partials/navbar') %>

<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
        <div class="flex items-center mb-8">
            <a href="/admin/notifikasi" class="btn btn-ghost btn-sm mr-4">
                <i class="fas fa-arrow-left"></i>
            </a>
            <h1 class="text-3xl font-bold text-gray-800">Buat Notifikasi Baru</h1>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6">
            <form action="/admin/notifikasi/buat" method="POST" id="notificationForm">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Judul Notifikasi -->
                    <div class="md:col-span-2">
                        <label for="judul" class="block text-sm font-medium text-gray-700 mb-2">
                            Judul Notifikasi <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="judul" name="judul" required
                               class="input input-bordered w-full text-black bg-gray-200" 
                               placeholder="Masukkan judul notifikasi">
                    </div>

                    <!-- Isi Notifikasi -->
                    <div class="md:col-span-2">
                        <label for="isi" class="block text-sm font-medium text-gray-700 mb-2">
                            Isi Notifikasi <span class="text-red-500">*</span>
                        </label>
                        <textarea id="isi" name="isi" rows="6" required
                                  class="textarea textarea-bordered w-full text-black bg-gray-200"
                                  placeholder="Masukkan isi notifikasi"></textarea>
                    </div>

                    <!-- Tujuan Pengiriman -->
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Tujuan Pengiriman <span class="text-red-500">*</span>
                        </label>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="radio" name="ditujukan_ke" value="semua" class="radio radio-success" checked>
                                <span class="ml-2">Semua Alumni</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="ditujukan_ke" value="tahun_lulus" class="radio radio-success">
                                <span class="ml-2">Alumni Berdasarkan Tahun Lulus</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="ditujukan_ke" value="spesifik" class="radio radio-success">
                                <span class="ml-2">Alumni Tertentu</span>
                            </label>
                        </div>
                    </div>

                    <!-- Tahun Lulus (conditional) -->
                    <div id="tahunLulusSection" class="md:col-span-2 hidden">
                        <label for="tahun_lulus" class="block text-sm font-medium text-gray-700 mb-2">
                            Tahun Lulus
                        </label>
                        <select id="tahun_lulus" name="tahun_lulus" class="select select-bordered w-full bg-gray-200">
                            <option value="">Pilih tahun lulus</option>
                            <% years.forEach(year => { %>
                                <option value="<%= year.tahun_lulus %>"><%= year.tahun_lulus %></option>
                            <% }); %>
                        </select>
                    </div>

                    <!-- Alumni Spesifik (conditional) -->
                    <div id="alumniSpesifikSection" class="md:col-span-2 hidden">
                        <label for="penerima_id" class="block text-sm font-medium text-gray-700 mb-2">
                            Pilih Alumni
                        </label>
                        <select id="penerima_id" name="penerima_id" class="select select-bordered w-full bg-gray-200">
                            <option value="">Pilih alumni</option>
                        </select>
                    </div>
                </div>

                <div class="flex justify-end space-x-4 mt-8">
                    <a href="/admin/notifikasi" class="btn btn-ghost">Batal</a>
                    <button type="submit" class="btn btn-primary justify-center border-white text-white bg-[#FFD700]">
                        <i class="fas fa-paper-plane mr-2"></i>
                        Kirim Notifikasi
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<%- include('admin-partials/footer') %>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tujuanRadios = document.querySelectorAll('input[name="ditujukan_ke"]');
    const tahunLulusSection = document.getElementById('tahunLulusSection');
    const alumniSpesifikSection = document.getElementById('alumniSpesifikSection');
    const tahunLulusSelect = document.getElementById('tahun_lulus');
    const penerimaSelect = document.getElementById('penerima_id');

    // Handle radio button changes
    tujuanRadios.forEach(radio => {
        radio.addEventListener('change', function() {
            tahunLulusSection.classList.add('hidden');
            alumniSpesifikSection.classList.add('hidden');
            
            if (this.value === 'tahun_lulus') {
                tahunLulusSection.classList.remove('hidden');
            } else if (this.value === 'spesifik') {
                alumniSpesifikSection.classList.remove('hidden');
                loadAlumniList();
            }
        });
    });

    // Load alumni list for specific selection
    function loadAlumniList() {
        fetch('/admin/notifikasi/alumni-list')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    penerimaSelect.innerHTML = '<option value="">Pilih alumni</option>';
                    data.alumni.forEach(alumni => {
                        const option = document.createElement('option');
                        option.value = alumni.id;
                        option.textContent = `${alumni.nama_lengkap} (${alumni.nim}) - ${alumni.tahun_lulus}`;
                        penerimaSelect.appendChild(option);
                    });
                }
            })
            .catch(error => {
                console.error('Error loading alumni list:', error);
            });
    }

    // Form validation
    document.getElementById('notificationForm').addEventListener('submit', function(e) {
        const judul = document.getElementById('judul').value.trim();
        const isi = document.getElementById('isi').value.trim();
        const ditujukanKe = document.querySelector('input[name="ditujukan_ke"]:checked').value;
        const tahunLulus = tahunLulusSelect.value;
        const penerimaId = penerimaSelect.value;

        if (!judul || !isi) {
            e.preventDefault();
            alert('Judul dan isi notifikasi harus diisi');
            return;
        }

        if (ditujukanKe === 'tahun_lulus' && !tahunLulusSelect.value) {
            e.preventDefault();
            alert('Pilih tahun lulus untuk melanjutkan');
            return;
        }

        if (ditujukanKe === 'spesifik' && !penerimaSelect.value) {
            e.preventDefault();
            alert('Pilih alumni untuk melanjutkan');
            return;
        }
    });
});
</script>
</body>
</html>
